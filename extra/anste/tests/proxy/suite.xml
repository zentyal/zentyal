<?xml version="1.0" encoding="UTF-8"?>
<suite>
    <name>eBox Proxy tests</name>
    <desc>
    Contains a set of tests to check
    that the eBox HTTP Proxy module works properly.
    </desc>

    <scenario>proxy.xml</scenario>

    <test type="selenium">
        <name>EnableModules</name>
        <desc>
        Enable network and firewall modules.
        </desc>

        <host>ebox-server</host>
        <dir>enable-modules</dir>
    </test>

    <test type="selenium">
        <name>ConfigNetworkSetExternal</name>
        <desc>
        Sets the interface as external.
        </desc>

        <host>ebox-server</host>
        <dir>set-external</dir>
        <var name="IFACE" value="eth2"/>
    </test>

    <test type="selenium">
        <name>ConfigProxyFilter</name>
        <desc>
        Config the proxy with filter mode and forbid a host.
        </desc>

        <host>ebox-server</host>
        <dir>config-proxy-filter</dir>
    </test>

    <test>
        <name>FilterAllowDownload</name>
        <desc>Try to download a file of an allowed host</desc>

        <host>test-client</host>
        <dir>test-allow</dir>
        <var name="HOST" value="www.google.com"/>
    </test>
    <test type="selenium">
        <name>TestLogFilterAllowDownload</name>
        <desc>Tests if proxy logs works ok</desc>

        <host>ebox-server</host>
        <dir>test-logs</dir>
        <var name="URL" value="www.google.com"/>
        <var name="EVENT" value="Accepted"/>
    </test>

    <test>
        <name>FilterForbidDownload</name>
        <desc>Try to download a file of a forbidden host</desc>

        <host>test-client</host>
        <dir>test-deny</dir>
        <var name="HOST" value="www.marca.com"/>
    </test>
    <test type="selenium">
        <name>TestLogFilterForbidDownload</name>
        <desc>Tests if proxy logs works ok</desc>

        <host>ebox-server</host>
        <dir>test-logs</dir>
        <var name="URL" value="www.marca.com"/>
        <var name="EVENT" value="Filtered"/>
    </test>

    <test type="selenium">
        <name>ContentFilterStrict</name>
        <desc>
	    Configure content filter setting its threshold to very strict.
        </desc>

        <host>ebox-server</host>
        <dir>content-filter-strict</dir>
    </test>

    <test>
        <name>AccessAdultContent</name>
        <desc>Try to access adult content with "very strict" filter mode</desc>

        <host>test-client</host>
        <dir>test-deny</dir>
        <var name="HOST" value="www.lupaland.com"/>
    </test>
    <test type="selenium">
        <name>TestLogAdultContent</name>
        <desc>Tests if proxy logs works ok</desc>

        <host>ebox-server</host>
        <dir>test-logs</dir>
        <var name="URL" value="www.lupaland.com"/>
        <var name="EVENT" value="Filtered"/>
    </test>

    <test type="selenium">
        <name>ConfigProxyDeny</name>
        <desc>
        Config the proxy with deny mode.
        </desc>

        <host>ebox-server</host>
        <dir>config-proxy-deny</dir>
    </test>

    <test>
        <name>TestDenyAll</name>
        <desc>Try to access google with deny all mode.</desc>

        <host>test-client</host>
        <dir>test-deny-all</dir>
    </test>
    <test type="selenium">
        <name>TestLogDenyAll</name>
        <desc>Tests if proxy logs works ok</desc>

        <host>ebox-server</host>
        <dir>test-logs</dir>
        <var name="URL" value="www.google.com"/>
        <var name="EVENT" value="Denied"/>
    </test>

    <test type="selenium">
        <name>ConfigProxyAllow</name>
        <desc>
        Config the proxy with allow mode.
        </desc>

        <host>ebox-server</host>
        <dir>config-proxy-allow</dir>
    </test>

    <test>
        <name>TestAllowAll</name>
        <desc>Try to access adult content with allow all mode.</desc>

        <host>test-client</host>
        <dir>test-allow</dir>
        <var name="HOST" value="www.lupaland.com"/>
    </test>
    <test type="selenium">
        <name>TestLogAllowAll</name>
        <desc>Tests if proxy logs works ok</desc>

        <host>ebox-server</host>
        <dir>test-logs</dir>
        <var name="URL" value="www.lupaland.com"/>
        <var name="EVENT" value="Accepted"/>
    </test>

    <test type="selenium">
        <name>AddGroupWithUser</name>
        <desc>
        Create a new user and add it to a new group.
        </desc>

        <host>ebox-server</host>
        <dir>add-user-to-group</dir>

        <var name="USERNAME" value="foo"/>
        <var name="PASSWORD" value="foo"/>
        <var name="GROUP" value="proxy-test"/>
    </test>

</suite>
